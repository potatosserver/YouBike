<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta name="google-site-verification" content="9o55RpXAKN7kR9cYHHvHkWuktV3JVcCYF5mt9XZULCY" />
    <meta name="google-site-verification" content="ahdkishmook7wgZXJ6JVA43nNO5SSccNOlvmB575Od4" />    
    <meta charset="UTF-8" />
    <meta name="author" content="卓稟鈞(AndrewCho)">
    <meta name="description" content="一個專為 YouBike 設計的簡單、美觀且低流量站點搜尋器，提供快速查詢站點資訊功能，滿足即時需求，適合所有用戶使用。">
    <meta name="keywords" content="YouBike, youBike, YouBike2.0, youBike2.0, ubike, ibike, obike, kbike, 微笑單車，公共自行車, 腳踏車，YouBike站點搜尋, 站點搜尋, YouBike 資訊, YouBike據點，ubike據點 ，附近站點, 附近YouBike站點, 全台YouBike, 台北YouBike, 新北YouBike, 桃園YouBike, 新竹YouBike, 苗栗YouBike, 臺中YouBike, 嘉義YouBike , 臺南YouBike, 高雄YouBike, 屏東YouBike, 臺東YouBike , YouBike即時資訊, 定位功能, Github, github.io" />
    <meta property="og:site_name" content="YouBike 站點搜尋" />
	  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YouBike 互動教學網站</title>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "YouBike 站點搜尋",
      "alternateName": ["YouBike 站點搜尋", "YouBike Site Search"],
      "url": "https://youbike.pages.dev/"
    }
    </script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/x-icon" href="/icons/icon.ico" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=offline_bolt" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        margin: 0;
        background: #f4f4f4;
        color: #333;
        transition: background 0.5s ease, color 0.5s ease;
        padding-top: 20px;
        --map-filter: none;
        --map-transition: filter 0.3s ease;
        --color-transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      *, *::before, *::after {
        transition: var(--color-transition);
      }

      .station,
      .station h3,
      .station p,
      #searchContainer,
      #keyword,
      #mainContent,
      .modal,
      #locationSwitchContainer,
      #settingsPanel,
      .settings-group,
      .setting-item {
        transition: var(--color-transition), transform 0.2s ease, box-shadow 0.2s ease;
      }
      .station, #settingsButton, #closeCentralSettings, #closeRouteModal {
          -webkit-tap-highlight-color: transparent;
      }

      #locationNotification {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #e8def8;
        color: #1c1b1f;
        padding: 12px 20px;
        border-radius: 20px;
        font-size: 14px;
        z-index: 10001;
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }

      #locationNotification.show {
        opacity: 1;
        transform: translateY(0);
      }
      .main-title {
        color: #007bff;
        text-align: center;
        margin-bottom: 8px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        padding: 4px;
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 8px;
        display: inline-block;
        font-size: 1.4em;
      }
      body.dark-mode .main-title {
        color: #90CAF9;
      }
      #searchContainer {
        display: flex;
        align-items: center;
        margin-left: auto;
        margin-right: auto;
        max-width: 500px;
        width: calc(100% - 40px);
        position: relative;
        padding: 8px 16px;
        box-sizing: border-box;
        background-color: #ffe8d6;
        border-radius: 28px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: box-shadow 0.3s ease;
      }

      body.dark-mode #searchContainer {
          background-color: #1e1e1e;
          box-shadow: 0 2px 4px rgba(255, 255, 255, 0.1);
      }

      #keyword {
        padding: 0;
        width: calc(100% - 34px);
        border: none;
        border-radius: 0;
        margin: 0;
        font-size: 16px;
        box-shadow: none;
        word-wrap: break-word;
        overflow-wrap: break-wrap;
        display: block;
        background-color: transparent;
        color: #333;
      }

      body.dark-mode #keyword {
          color: #ffffff;
      }
      #keyword::placeholder {
        color: #888;
      }
      #keyword:focus {
        outline: none;
      }

      #searchIcon {
        position: static;
        margin-left: 10px;
        font-size: 24px;
        cursor: pointer;
        color: #555;
        transition: color 0.3s ease;
        flex-shrink: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
      }

      body.dark-mode #searchIcon {
          color: #ccc;
      }

      #searchIcon:hover {
        color: #007BFF;
      }

      #results {
        margin-top: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        padding: 0 20px;
      }
      .station {
        background-color: #fff2ec;
        border: 1px solid #e0e0e0;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 10px;
        width: calc(33% - 20px);
        min-width: 250px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        word-wrap: break-word;
        overflow-wrap: break-word;
        cursor: pointer;
        position: relative;
      }
      .station:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      }
      .station .header {
          display: flex;
          align-items: flex-start;
          justify-content: space-between;
          margin-bottom: 10px;
          gap: 10px;
      }
      .station h3 {
        margin: 0;
        color: #007BFF;
        font-size: 1.2em;
        word-wrap: break-word;
        overflow-wrap: break-word;
        flex-grow: 1;
      }
      .station .icon-group {
          display: flex;
          align-items: center;
          gap: 5px;
          flex-shrink: 0;
          padding-top: 0;
      }
      .station .pin-button {
        font-size: 24px;
        cursor: pointer;
        color: #007BFF;
        transition: color 0.2s ease;
        user-select: none;
      }
      .station .pin-button.pinned {
          color: #FFD700;
      }
      .navigate-button {
        background: none;
        border: none;
        padding: 0;
        font-size: 24px;
        color: #007BFF;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.3s ease, background-color 0.3s ease;
        -webkit-tap-highlight-color: transparent;
        outline: none;
        border-radius: 50%;
      }
      .navigate-button:hover {
        background-color: transparent;
        color: #0056b3;
      }
      .station .electric-icon {
          font-size: 24px;
          color: #4CAF50;
          display: none;
          cursor: pointer;
      }
      .station .electric-icon.show {
          display: block;
      }
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }
      .overlay.show {
        display: block;
      }
      .modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        text-align: center;
        display: none;
      }
      .modal.show {
        display: block;
      }
      .modal button {
        margin: 10px auto;
        display: block;
        padding: 10px 20px;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s ease;
      }
      .modal button:hover {
        background-color: #0056b3;
      }
      body.dark-mode {
        background: #333;
        color: #ffffff;
      }
      body.dark-mode h1 {
        color: #90CAF9;
      }
      body.dark-mode #keyword {
        background-color: transparent;
        color: #ffffff;
        border-color: #90caf9;
      }
       body.dark-mode #searchContainer {
          background-color: #1e1e1e;
      }
       body.dark-mode #searchIcon {
          color: #ccc;
      }
      body.dark-mode .station {
        background-color: #444;
        border-color: #555;
      }
      body.dark-mode .station h3 {
        color: #90CAF9;
      }
      body.dark-mode .station p {
        color: #cccccc;
      }
      body.dark-mode .modal {
        background-color: #333;
        color: #ffffff;
      }
      #map {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 1;
        touch-action: none;
      }
      #mainContent {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #fff5f0;
        height: 40vh;
        min-height: 200px;
        max-height: 85vh;
        z-index: 2;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        padding-top: 0;
        width: 85%;
        max-width: 1000px;
        margin: 0 auto;
        left: 50%;
        transform: translateX(-50%);
        touch-action: pan-y;
        -webkit-overflow-scrolling: touch;
        overflow-y: auto;
      }

      #mainContent::-webkit-scrollbar {
        display: none;
      }

      body.dark-mode #mainContent {
        background: #222;
      }

      #dragHandle {
        position: sticky;
        top: 0;
        z-index: 100;
        height: 24px;
        width: 100px;
        cursor: ns-resize;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 auto;
        padding: 0;
        background-color: #fff5f0;
      }
      body.dark-mode #dragHandle {
          background-color: #222;
      }

      #dragHandle::before {
        content: '';
        width: 100px;
        height: 6px;
        background: #a0a0a0;
        border-radius: 3px;
      }

      body.dark-mode #dragHandle::before {
        background: #888;
      }
      @media (max-width: 768px) {
        #mainContent {
          width: 80%;
        }
      }

      @media (max-width: 480px) {
        #mainContent {
          width: 100%;
          padding: 0;
          max-width: none;
        }
        #results {
          padding: 0 16px;
        }
        .station {
          margin: 10px 0;
          width: calc(100% - 32px);
          border-radius: 10px;
        }
      }      @media (max-width: 768px) {
        .station {
          width: calc(50% - 20px);
        }
      }
      @media (max-width: 480px) {
        .station {
          width: 100%;
        }
      }
      #loadingOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 1);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9998;
        transition: opacity 0.5s ease;
        opacity: 0;
        pointer-events: none;
      }
      body.dark-mode #loadingOverlay {
        background-color: rgba(51, 51, 51, 1);
      }
      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #007BFF;
      }
      input:checked + .slider:before {
        transform: translateX(26px);
      }

      #settingsButton {
          position: fixed;
          bottom: 60px;
          right: 20px;
          z-index: 1600;
          width: 56px;
          height: 56px;
          background: #ffdacf;
          color: #333;
          border: none;
          border-radius: 16px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 28px;
          box-shadow: 0 3px 5px rgba(0,0,0,0.2);
          transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }
      body.dark-mode #settingsButton {
          background-color: #e8def8;
          color: #1c1b1f;
      }
      #mapControls {
        position: fixed;
        top: 8px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 999 !important;
        width: 90%;
        max-width: 800px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        pointer-events: none;
      }
      #mapControls > * {
        pointer-events: auto;
      }
      #mapControls h1 {
        color: #007BFF;
        background-color: transparent;
        display: inline;
        padding: 0;
      }
      body.dark-mode #mapControls h1 {
        color: #90CAF9;
      }

      #centralSettingsPanel {
          display: none;
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 80%;
          max-width: 320px;
          background: #fff5f0;
          border-radius: 20px;
          padding: 25px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
          z-index: 1500;
          backdrop-filter: blur(10px);
          max-height: calc(100vh - 80px);
          overflow-y: scroll;
          scrollbar-width: none;
          transition: background-color 0.1s ease;
          opacity: 0;
          animation-duration: 0.3s;
          animation-fill-mode: forwards;
      }
      body.dark-mode #centralSettingsPanel {
          background: rgba(30, 30, 30, 0.95);
      }
      .settings-group {
          margin-bottom: 20px;
          padding: 15px;
          background: #fff2ec;
          border: 1px solid #000;
          border-radius: 10px;
      }
      body.dark-mode .settings-group {
          border-color: #fff;
          background: transparent;
      }
      .setting-item {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 15px;
          padding: 10px;
          background: #ffe8d6;
          border-radius: 8px;
      }
      body.dark-mode .setting-item {
          background: #455a64;
      }
      #closeCentralSettings {
          position: absolute;
          top: 2vh;
          right: 2vh;
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          padding: 8px;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
      }
      body.dark-mode #closeCentralSettings {
          color: #fff;
      }

      @keyframes slideIn {
        from { transform: translate(-50%, -60%) scale(0.8); opacity: 0; }
        to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        to { transform: translate(-50%, -60%) scale(0.8); opacity: 0; }
      }
      #centralSettingsPanel.panel-open {
        animation-name: slideIn;
        opacity: 1;
      }
      #centralSettingsPanel.panel-close {
        animation-name: slideOut;
        opacity: 0;
      }

      #settingsPanelTitle {
          color: #333;
      }
      body.dark-mode #settingsPanelTitle {
          color: #fff;
      }
      .station p {
        margin: 4px 0;
        color: #666;
      }
      body.dark-mode .station p {
        color: #cccccc;
      }
      #routeModal {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: #fff5f0;
          padding: 24px;
          border-radius: 20px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
          z-index: 1001;
          display: none;
          width: 80%;
          max-width: 360px;
          max-height: calc(100vh - 80px);
          overflow-y: auto;
          scrollbar-width: none;
          -ms-overflow-style: none;
          text-align: left;
          transition: background-color 0.3s ease, box-shadow 0.3s ease;
          backdrop-filter: blur(10px);
          animation-duration: 0.3s;
          animation-fill-mode: forwards;
          opacity: 0;
      }
      #routeModal.modal-open {
          animation-name: slideIn;
          opacity: 1;
      }
      #routeModal.modal-close {
          animation-name: slideOut;
          opacity: 0;
      }
      #routeModal::-webkit-scrollbar {
          display: none;
      }
      body.dark-mode #routeModal {
          background-color: rgba(30, 30, 30, 0.95);
      }
      #routeModal h3 {
          margin-top: 30px;
          margin-bottom: 20px;
          padding-right: 56px;
          color: #007BFF;
          font-size: 1.3em;
          word-break: break-word;
      }
      body.dark-mode #routeModal h3 {
          color: #90CAF9;
      }
      #routeModal .bike-item {
          padding: 16px;
          margin-bottom: 12px;
          background-color: #fff2ec;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          display: flex;
          flex-direction: column;
          gap: 8px;
      }
      body.dark-mode #routeModal .bike-item {
          background-color: #444;
      }
      #routeModal .bike-item p {
          margin: 0;
          font-size: 14px;
          display: flex;
          align-items: center;
          gap: 8px;
      }
      #closeRouteModal {
          position: absolute;
          top: 12px;
          right: 12px;
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          padding: 8px;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
      }
      body.dark-mode #closeRouteModal {
          color: #ccc;
      }
      #routeModal ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      #routeModal .bike-item:last-child {
        margin-bottom: 0;
      }
      
      /* --- START: TUTORIAL STYLES --- */
      #tutorial-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.7);
          z-index: 9990;
          pointer-events: none;
          transition: clip-path 0.5s ease-in-out;
      }

      #tutorial-tooltip {
          position: fixed;
          background: #fff;
          color: #333;
          padding: 20px;
          border-radius: 12px;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
          z-index: 9991;
          opacity: 0;
          transform: scale(0.9);
          transition: opacity 0.3s ease, transform 0.3s ease, top 0.3s ease, left 0.3s ease;
          visibility: hidden;
      }
      
      /* Default desktop layout */
      #tutorial-tooltip {
         max-width: 320px;
      }
      
      /* Responsive mobile layout */
      #tutorial-tooltip.mobile-layout {
        top: 10px;
        left: 10px;
        right: 10px;
        width: auto;
        max-width: calc(100% - 20px);
        transform: none; /* Override default transform for mobile */
      }


      #tutorial-tooltip.show {
          opacity: 1;
          transform: scale(1);
          visibility: visible;
      }
      
      #tutorial-tooltip.mobile-layout.show {
        transform: none;
      }


      #tutorial-tooltip h3 {
          margin-top: 0;
          color: #007BFF;
      }

      #tutorial-tooltip p {
          margin-bottom: 20px;
          line-height: 1.6;
      }

      #tooltip-nav {
          display: flex;
          align-items: center;
          justify-content: flex-end;
      }

      #tooltip-nav button {
          padding: 8px 16px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          background-color: #007BFF;
          color: white;
          font-weight: bold;
      }
      #tooltip-nav button:hover {
          background-color: #0056b3;
      }
      /* --- END: TUTORIAL STYLES --- */
    </style>
  </head>
  <body>
    <!-- The original UI structure is kept for the tutorial to point to -->
    <div id="map"></div>
    <div id="mapControls">
      <h1 id="heading" class="main-title">YouBike 互動教學</h1>
      </div>
    <div id="locationNotification"></div>
    <div id="loadingOverlay"></div>
    <div id="mainContent">
      <div id="dragHandle"></div>
      <div id="searchContainer">
        <input type="text" id="keyword" placeholder="請輸入站點名稱、地址" value="" />
        <span id="searchIcon" class="material-icons" title="搜尋">search</span>
      </div>
      <div id="results"></div>
      </div>
      <div class="overlay"></div>
      <div class="modal" id="routeModal">
          <button id="closeRouteModal">×</button>
          <h3 id="routeModalTitle">路線資訊</h3>
          <div id="routeDetails"></div>
      </div>
    <button id="settingsButton" title="設定">
        <span class="material-icons">settings</span>
    </button>
    <div id="centralSettingsPanel">
      <button id="closeCentralSettings">×</button>
      <h2 id="settingsPanelTitle">系統設定</h2>
      <div class="settings-group">
              <h3>基本設定</h3>
              <div class="setting-item">
                  <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="material-icons">dark_mode</span>
                      <label for="centralDarkModeToggle">深色模式</label>
                  </div>
                  <label class="switch">
                      <input type="checkbox" id="centralDarkModeToggle">
                      <span class="slider"></span>
                  </label>
              </div>
              <div class="setting-item">
                  <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="material-icons">language</span>
                      <label for="centralLangToggle">中文/English</label>
                  </div>
                  <label class="switch">
                      <input type="checkbox" id="centralLangToggle">
                      <span class="slider"></span>
                  </label>
              </div>
          </div>
    </div>

    <!-- --- START: TUTORIAL HTML --- -->
    <div id="tutorial-overlay"></div>
    <div id="tutorial-tooltip">
      <h3 id="tooltip-title"></h3>
      <p id="tooltip-text"></p>
      <div id="tooltip-nav">
        <div>
          <button id="tutorial-prev" style="margin-right: 8px;">上一步</button>
          <button id="tutorial-next">下一步</button>
        </div>
      </div>
    </div>
    <!-- --- END: TUTORIAL HTML --- -->

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

    <script>
      // --- START: SIMPLIFIED & MOCKED APPLICATION LOGIC ---

      let leafletMap, markerClusterGroup, tileLayer;
      const kaohsiungCoords = { lat: 22.627278, lng: 120.29126 };
      let currentLang = "zh";
      let closeModalTimeout;
      // FIX: Create an object to store map markers by their station ID
      let markers = {};

      // Mock data centered in Kaohsiung
      const mockYoubikeData = [
          { station_no: '1', name_tw: '捷運鹽埕埔站(4號出口)', name_en: 'MRT Yanchengpu Sta. (Exit 4)', address_tw: '五福四路/大勇路口', address_en: 'Wufu 4th Rd. & Dayong Rd.', lat: 22.62531, lng: 120.2825, has_electric: true },
          { station_no: '2', name_tw: '高雄流行音樂中心', name_en: 'Kaohsiung Music Center', address_tw: '真愛路/公園二路口', address_en: 'Zhenai Rd. & Gungyuan 2nd Rd.', lat: 22.6192, lng: 120.2868, has_electric: false },
          { station_no: '3', name_tw: '捷運西子灣站(1號出口)', name_en: 'MRT Sizihwan Sta. (Exit 1)', address_tw: '臨海二路/鼓山一路口', address_en: 'Linhai 2nd Rd. & Gushan 1st Rd.', lat: 22.624, lng: 120.270, has_electric: true },
          { station_no: '4', name_tw: '駁二藝術特區', name_en: 'The Pier-2 Art Center', address_tw: '大勇路1號', address_en: 'No. 1, Dayong Rd.', lat: 22.621, lng: 120.279, has_electric: false }
      ];

      const pinnedStations = new Set();
      const resultsDiv = document.getElementById('results');
      const keywordInput = document.getElementById('keyword');

      document.addEventListener('DOMContentLoaded', initializeApp);

      function initializeApp() {
          initMap();
          searchYouBike(); // Initial population of stations
          setupEventListeners();
          // Start the tutorial after a short delay to ensure UI is ready
          setTimeout(startTutorial, 500);
      }

      function initMap() {
          if (leafletMap) return;
          leafletMap = L.map('map').setView([kaohsiungCoords.lat, kaohsiungCoords.lng], 15);
          tileLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
              maxZoom: 19,
              attribution: '© OpenStreetMap'
          }).addTo(leafletMap);
          markerClusterGroup = L.markerClusterGroup().addTo(leafletMap);
          updateMapMarkers(mockYoubikeData);
      }

      function updateMapMarkers(stations) {
          markerClusterGroup.clearLayers();
          // FIX: Clear the markers object before repopulating
          markers = {};
          stations.forEach(station => {
              const marker = L.marker([station.lat, station.lng]);
              marker.bindPopup(`<b>${station.name_tw}</b><br>${station.address_tw}`);
              markerClusterGroup.addLayer(marker);
              // FIX: Store the marker instance using its unique station number
              markers[station.station_no] = marker;
          });
      }

      function searchYouBike() {
          const keyword = keywordInput.value.trim().toLowerCase();
          let results = mockYoubikeData;

          if (keyword) {
              results = mockYoubikeData.filter(station =>
                  station.name_tw.toLowerCase().includes(keyword) ||
                  station.name_en.toLowerCase().includes(keyword) ||
                  station.address_tw.toLowerCase().includes(keyword) ||
                  station.address_en.toLowerCase().includes(keyword)
              );
          }
          renderResults(results);
      }
      
      function renderResults(stations) {
        resultsDiv.innerHTML = '';
        const sortedStations = [...stations].sort((a, b) => {
            const aPinned = pinnedStations.has(a.station_no);
            const bPinned = pinnedStations.has(b.station_no);
            if (aPinned && !bPinned) return -1;
            if (!aPinned && bPinned) return 1;
            return 0;
        });

        if (sortedStations.length === 0) {
          resultsDiv.innerHTML = `<p style="text-align: center; width: 100%;">${currentLang === 'zh' ? '找不到相符的站點' : 'No matching stations found'}</p>`;
          return;
        }

        sortedStations.forEach(site => {
            const isPinned = pinnedStations.has(site.station_no);
            const name = currentLang === 'en' ? site.name_en : site.name_tw;
            const address = currentLang === 'en' ? site.address_en : site.address_tw;
            
            const card = document.createElement('div');
            card.className = 'station';
            card.dataset.id = site.station_no;
            card.dataset.lat = site.lat;
            card.dataset.lng = site.lng;

            card.innerHTML = `
                <div class="header">
                    <h3>${name}</h3>
                    <div class="icon-group">
                        <span class="material-symbols-outlined electric-icon ${site.has_electric ? 'show' : ''}" title="${currentLang === 'en' ? 'Electric Bike Available' : '有電輔車'}">offline_bolt</span>
                        <span class="material-icons pin-button ${isPinned ? 'pinned' : ''}" title="${currentLang === 'en' ? 'Pin Station' : '釘選站點'}">${isPinned ? 'star' : 'star_outline'}</span>
                        <button class="navigate-button" title="${currentLang === 'en' ? 'Navigate' : '導航'}">
                            <span class="material-icons">navigation</span>
                        </button>
                    </div>
                </div>
                <p>${currentLang === 'en' ? 'Address:' : '地址:'} ${address}</p>
                <p>YouBike 2.0: <span class="vehicle_yb2">8</span></p>
                <p>YouBike 2.0E: <span class="vehicle_ybe">${site.has_electric ? 3 : 0}</span></p>
                <p>${currentLang === 'en' ? 'Available Slots:' : '可停空位數:'} <span class="vehicle_empty">12</span></p>
            `;
            // Add event listeners to the new elements
            card.addEventListener('click', () => {
              leafletMap.setView([site.lat, site.lng], 17);
            });
            card.querySelector('.pin-button').addEventListener('click', (e) => {
              e.stopPropagation();
              togglePinStation(site.station_no, e.currentTarget);
            });
            card.querySelector('.navigate-button').addEventListener('click', (e) => {
              e.stopPropagation();
              showMockRoute(name);
            });
            if (site.has_electric) {
              card.querySelector('.electric-icon').addEventListener('click', (e) => {
                e.stopPropagation();
                showMockElectricBikes(name);
              });
            }

            resultsDiv.appendChild(card);
        });
      }
      
      function togglePinStation(stationId, element) {
          if (pinnedStations.has(stationId)) {
              pinnedStations.delete(stationId);
              element.classList.remove('pinned');
              element.textContent = 'star_outline';
          } else {
              pinnedStations.add(stationId);
              element.classList.add('pinned');
              element.textContent = 'star';
          }
          // Re-render to show pinned station at the top
          searchYouBike();
      }

      function showMockRoute(stationName) {
        const routeModal = document.getElementById('routeModal');
        const overlay = document.querySelector('.overlay');
        
        clearTimeout(closeModalTimeout);
        routeModal.classList.remove('modal-close');

        document.getElementById('routeModalTitle').textContent = `${currentLang === 'en' ? 'Route to' : '前往'} ${stationName}`;
        document.getElementById('routeDetails').innerHTML = `
            <h4>${currentLang === 'en' ? 'Walking Route (Simulation)' : '步行路線 (模擬)'}</h4>
            <p><span class="material-icons" style="vertical-align: middle;">directions_walk</span> ${currentLang === 'en' ? 'Distance:' : '距離:'} 0.8 km</p>
            <p><span class="material-icons" style="vertical-align: middle;">timer</span> ${currentLang === 'en' ? 'Est. Time:' : '預計時間:'} 10 ${currentLang === 'en' ? 'minutes' : '分鐘'}</p>
            <h4>${currentLang === 'en' ? 'Instructions:' : '導航步驟:'}</h4>
            <ul>
              <li class="bike-item"><p><span class="material-icons" style="vertical-align: middle;">arrow_upward</span> ${currentLang === 'en' ? 'Head north on Main St' : '沿著主要街道向北直行'}</p></li>
              <li class="bike-item"><p><span class="material-icons" style="vertical-align: middle;">turn_right</span> ${currentLang === 'en' ? 'Turn right onto Park Ave' : '在公園大道向右轉'}</p></li>
              <li class="bike-item"><p><span class="material-icons" style="vertical-align: middle;">flag</span> ${currentLang === 'en' ? 'Destination will be on the left' : '目的地在您的左手邊'}</p></li>
            </ul>
        `;
        routeModal.style.display = 'block';
        routeModal.classList.add('modal-open');
        overlay.classList.add('show');
      }

      function showMockElectricBikes(stationName) {
        const routeModal = document.getElementById('routeModal');
        const overlay = document.querySelector('.overlay');

        clearTimeout(closeModalTimeout);
        routeModal.classList.remove('modal-close');

        document.getElementById('routeModalTitle').textContent = `${currentLang === 'en' ? 'Electric Bikes at' : '電輔車於'} ${stationName}`;
        document.getElementById('routeDetails').innerHTML = `
            <ul>
              <li class="bike-item">
                  <p><span class="material-icons" style="vertical-align: middle;">directions_bike</span> ${currentLang === 'en' ? 'Bike No.:' : '車輛編號：'} E-12345</p>
                  <p><span class="material-icons" style="vertical-align: middle;">battery_charging_full</span> ${currentLang === 'en' ? 'Battery:' : '電量：'} 95%</p>
              </li>
              <li class="bike-item">
                  <p><span class="material-icons" style="vertical-align: middle;">directions_bike</span> ${currentLang === 'en' ? 'Bike No.:' : '車輛編號：'} E-67890</p>
                  <p><span class="material-icons" style="vertical-align: middle;">battery_charging_full</span> ${currentLang === 'en' ? 'Battery:' : '電量：'} 81%</p>
              </li>
            </ul>
        `;
        routeModal.style.display = 'block';
        routeModal.classList.add('modal-open');
        overlay.classList.add('show');
      }

      function updateLanguageTexts() {
          document.title = currentLang === 'en' ? 'YouBike Interactive Tutorial' : 'YouBike 互動教學網站';
          document.getElementById('heading').textContent = currentLang === 'en' ? 'YouBike Tutorial' : 'YouBike 互動教學';
          document.getElementById('keyword').placeholder = currentLang === 'en' ? 'Enter station name or address' : '請輸入站點名稱、地址';
          document.getElementById('settingsPanelTitle').textContent = currentLang === 'en' ? 'System Settings' : '系統設定';
          document.querySelector('label[for="centralDarkModeToggle"]').textContent = currentLang === 'en' ? 'Dark Mode' : '深色模式';
          document.querySelector('label[for="centralLangToggle"]').textContent = currentLang === 'en' ? 'Chinese/English' : '中文/English';
          
          // Re-render cards with new language
          searchYouBike();
      }

      function setupEventListeners() {
          document.getElementById('searchIcon').addEventListener('click', searchYouBike);
          keywordInput.addEventListener('keypress', (e) => {
              if (e.key === 'Enter') searchYouBike();
          });

          // Drag handle for main content panel
          const mainContent = document.getElementById('mainContent');
          const dragHandle = document.getElementById('dragHandle');
          let isDragging = false, startY, startHeight;
          const onStart = (e) => {
              isDragging = true;
              startY = e.touches ? e.touches[0].clientY : e.clientY;
              startHeight = mainContent.offsetHeight;
              mainContent.style.transition = 'none';
              document.body.style.cursor = 'ns-resize';
          };
          const onMove = (e) => {
              if (!isDragging) return;
              const currentY = e.touches ? e.touches[0].clientY : e.clientY;
              const deltaY = startY - currentY;
              const newHeight = Math.min(Math.max(startHeight + deltaY, 200), window.innerHeight * 0.85);
              mainContent.style.height = `${newHeight}px`;
          };
          const onEnd = () => {
              isDragging = false;
              mainContent.style.transition = 'height 0.2s ease';
              document.body.style.cursor = '';
          };
          dragHandle.addEventListener('mousedown', onStart);
          dragHandle.addEventListener('touchstart', onStart, { passive: false });
          document.addEventListener('mousemove', onMove);
          document.addEventListener('touchmove', onMove, { passive: true });
          document.addEventListener('mouseup', onEnd);
          document.addEventListener('touchend', onEnd);
          
          // Settings Panel
          const settingsButton = document.getElementById('settingsButton');
          const centralSettingsPanel = document.getElementById('centralSettingsPanel');
          const closeSettingsButton = document.getElementById('closeCentralSettings');
          const overlay = document.querySelector('.overlay');

          const openSettings = () => {
              centralSettingsPanel.style.display = 'block';
              centralSettingsPanel.classList.remove('panel-close');
              centralSettingsPanel.classList.add('panel-open');
              overlay.classList.add('show');
          };
          const closeSettings = () => {
              centralSettingsPanel.classList.remove('panel-open');
              centralSettingsPanel.classList.add('panel-close');
              overlay.classList.remove('show');
              setTimeout(() => {
                if (!centralSettingsPanel.classList.contains('panel-open')) {
                    centralSettingsPanel.style.display = 'none';
                }
              }, 300);
          };
          settingsButton.addEventListener('click', (e) => {
              e.stopPropagation();
              if (centralSettingsPanel.style.display === 'block') {
                  closeSettings();
              } else {
                  openSettings();
              }
          });
          closeSettingsButton.addEventListener('click', closeSettings);
          
          // Close Modals
          const closeRouteModalButton = document.getElementById('closeRouteModal');
          const routeModal = document.getElementById('routeModal');
          const closeRouteModal = () => {
              routeModal.classList.remove('modal-open');
              routeModal.classList.add('modal-close');
              overlay.classList.remove('show');
              clearTimeout(closeModalTimeout);
              closeModalTimeout = setTimeout(() => {
                  routeModal.style.display = 'none';
              }, 300);
          };
          closeRouteModalButton.addEventListener('click', closeRouteModal);
          overlay.addEventListener('click', () => {
              closeSettings();
              closeRouteModal();
          });

          // Dark Mode Toggle
          document.getElementById('centralDarkModeToggle').addEventListener('change', (e) => {
              document.body.classList.toggle('dark-mode', e.target.checked);
              if (tileLayer) {
                  tileLayer._container.style.filter = e.target.checked ? 'invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%)' : 'none';
              }
          });
          
          // Language Toggle
          document.getElementById('centralLangToggle').addEventListener('change', (e) => {
              currentLang = e.target.checked ? 'en' : 'zh';
              updateLanguageTexts();
          });
      }

      // --- END: SIMPLIFIED & MOCKED APPLICATION LOGIC ---


      // --- START: INTERACTIVE TUTORIAL ENGINE ---

      const tutorialOverlay = document.getElementById('tutorial-overlay');
      const tutorialTooltip = document.getElementById('tutorial-tooltip');
      const tooltipTitle = document.getElementById('tooltip-title');
      const tooltipText = document.getElementById('tooltip-text');
      const nextBtn = document.getElementById('tutorial-next');
      const prevBtn = document.getElementById('tutorial-prev');

      let currentStep = -1;
      let tutorialActive = false;
      
      const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));

      // FIX: Add a function to close any open modal/panel before proceeding
      const cleanupPreviousStep = () => {
          const routeModal = document.getElementById('routeModal');
          const settingsPanel = document.getElementById('centralSettingsPanel');

          if (routeModal.style.display === 'block') {
              document.getElementById('closeRouteModal').click();
          }
          if (settingsPanel.style.display === 'block') {
              document.getElementById('closeCentralSettings').click();
          }
      };

      const tutorialSteps = [
          {
              title: "歡迎來到 YouBike 互動教學", text: "我們將引導您了解此網站的主要功能。點擊「下一步」開始吧！",
              element: 'body', preferredPosition: 'center'
          },
          {
              title: "搜尋站點", text: "在這裡輸入站點的名稱或地址關鍵字，然後按下 Enter 鍵或點擊右方的放大鏡圖示來尋找站點。",
              element: '#searchContainer', preferredPosition: 'bottom', action: () => { keywordInput.value = '捷運'; searchYouBike(); }
          },
          {
              title: "釘選我的最愛", text: "點擊這個星號圖示，可以將常用站點釘選在列表頂部，方便您快速查看。",
              element: '.station:first-child .pin-button', preferredPosition: 'bottom', action: async () => { 
                  keywordInput.value = ''; 
                  searchYouBike(); 
                  await sleep(200);
                  document.querySelector('.station:first-child .pin-button')?.click();
              }
          },
          {
              title: "操作地圖", text: "您可以直接在地圖上拖曳來移動、使用滑鼠滾輪或雙指來縮放，尋找您感興趣的區域。",
              element: '#heading',
              preferredPosition: 'bottom-center',
              isMap: true
          },
          {
              title: "查看站點資訊", text: "點擊任一張站點卡片，地圖就會自動移動到該站點的位置並放大，同時對應的地圖圖標也會被點亮。",
              element: '.station:nth-child(2)',
              preferredPosition: 'left',
              action: async () => { 
                  const el = document.querySelector('.station:nth-child(2)'); 
                  if(el) el.click();
                  await sleep(300);
              },
              alsoHighlightDynamic: (primaryElement) => {
                  const stationId = primaryElement.dataset.id;
                  const marker = markers[stationId];
                  if (marker && marker._icon) {
                      return marker._icon;
                  }
                  return null;
              }
          },
          {
              title: "電輔車資訊", text: "這個綠色的閃電圖示代表該站點「有提供」YouBike 2.0E 電輔車。點擊它可以查看詳細的車輛電量。",
              element: '.station:first-child .electric-icon', preferredPosition: 'bottom'
          },
          {
              title: "查看電輔車電量", text: "這裡會列出站點上所有電輔車的編號和剩餘電量(模擬資料)，幫助您選擇電力最充足的一台！",
              element: '#routeModal', preferredPosition: 'center', action: async () => { 
                  const s = mockYoubikeData.find(s => s.has_electric); 
                  if (s) showMockElectricBikes(currentLang === 'en' ? s.name_en : s.name_tw); 
                  await sleep(350);
              }
          },
          {
              title: "路線導航", text: "點擊導航圖示，系統會為您規劃從目前位置到該站點的步行路線(此為模擬路線)。",
              element: '#routeModal', preferredPosition: 'center', action: async () => { 
                  const s = mockYoubikeData[1]; 
                  showMockRoute(currentLang === 'en' ? s.name_en : s.name_tw); 
                  await sleep(350);
              }
          },
          {
              title: "調整面板大小", text: "按住這個橫條並上下拖曳，您可以自由調整下方資訊面板的高度。",
              element: '#dragHandle', preferredPosition: 'top'
          },
          {
              title: "開啟設定", text: "點擊右下角的齒輪圖示，可以打開系統設定面板。",
              element: '#settingsButton', preferredPosition: 'left', action: async () => { 
                  document.getElementById('settingsButton').click(); 
                  await sleep(350);
              }, 
              alsoHighlight: '#centralSettingsPanel'
          },
          {
              title: "深色模式 & 語言切換", text: "在設定面板中，您可以輕鬆切換深色模式，或是將介面語言更換為英文。",
              element: '#centralSettingsPanel .settings-group .setting-item:nth-of-type(1)',
              preferredPosition: 'left',
              alsoHighlight: '#centralSettingsPanel .settings-group .setting-item:nth-of-type(2)',
              action: async () => {
                  const panel = document.getElementById('centralSettingsPanel');
                  if (panel.style.display !== 'block' || panel.classList.contains('panel-close')) {
                      document.getElementById('settingsButton').click();
                      await sleep(350);
                  }
              }
          },
          {
              title: "教學結束", text: "您已完成所有主要功能的學習！現在您可以自由探索了。祝您使用愉快！",
              element: 'body', preferredPosition: 'center'
          }
      ];

      async function startTutorial() {
          tutorialActive = true;
          currentStep = 0;
          await showStep(currentStep);
          window.addEventListener('resize', handleResize);
      }

      function endTutorial() {
          tutorialActive = false;
          tutorialOverlay.style.clipPath = 'polygon(0 0, 100% 0, 100% 100%, 0 100%)';
          tutorialTooltip.classList.remove('show', 'mobile-layout');
          window.removeEventListener('resize', handleResize);
      }

      const handleResize = () => {
        if(tutorialActive) {
            showStep(currentStep);
        }
      };
      
      async function showStep(index) {
          if (index < 0 || index >= tutorialSteps.length) {
              endTutorial();
              return;
          }
          
          cleanupPreviousStep();
          await sleep(400); // Wait for cleanup animations to finish

          const step = tutorialSteps[index];

          if(step.action) await step.action();
          
          const targetElement = document.querySelector(step.element);
          if (!targetElement) { endTutorial(); return; }

          const rect = targetElement.getBoundingClientRect();
          tooltipTitle.textContent = step.title;
          tooltipText.textContent = step.text;
          prevBtn.style.display = index === 0 ? 'none' : 'inline-block';
          nextBtn.textContent = index === tutorialSteps.length - 1 ? '完成' : '下一步';
          
          const isMobile = window.innerWidth <= 768;
          tutorialTooltip.classList.toggle('mobile-layout', isMobile && !step.isMap);

          let clipPathValue = '';
          const p = 10; // padding

          let secondElement = null;
          if (step.alsoHighlight) {
              secondElement = document.querySelector(step.alsoHighlight);
          } else if (step.alsoHighlightDynamic) {
              secondElement = step.alsoHighlightDynamic(targetElement);
          }

          if (secondElement) {
              const rect2 = secondElement.getBoundingClientRect();
              if (rect2.width > 0 && rect2.height > 0) {
                  const pathData = `M 0 0 H ${window.innerWidth} V ${window.innerHeight} H 0 Z ` +
                                   `M ${rect.left - p} ${rect.top - p} H ${rect.right + p} V ${rect.bottom + p} H ${rect.left - p} Z ` +
                                   `M ${rect2.left - p} ${rect2.top - p} H ${rect2.right + p} V ${rect2.bottom + p} H ${rect2.left - p} Z`;
                  clipPathValue = `path(evenodd, '${pathData}')`;
              }
          }

          if (!clipPathValue) {
              if (step.preferredPosition === 'center' && step.element === 'body') {
                  clipPathValue = `polygon(0 0, 100% 0, 100% 100%, 0 100%)`;
              } else if (step.isMap) {
                  const mainContentRect = document.getElementById('mainContent').getBoundingClientRect();
                  const mapRect = { top: 0, left: 0, right: window.innerWidth, bottom: mainContentRect.top };
                  const mapPadding = 0;
                  clipPathValue = `polygon(0 0, 100% 0, 100% 100%, 0 100%, 0 ${mapRect.top - mapPadding}px, ${mapRect.left - mapPadding}px ${mapRect.top - mapPadding}px, ${mapRect.left - mapPadding}px ${mapRect.bottom + mapPadding}px, ${mapRect.right + mapPadding}px ${mapRect.bottom + mapPadding}px, ${mapRect.right + mapPadding}px ${mapRect.top - mapPadding}px, 0 ${mapRect.top - mapPadding}px)`;
              } else {
                  clipPathValue = `polygon(0 0, 100% 0, 100% 100%, 0 100%, 0 ${rect.top - p}px, ${rect.left - p}px ${rect.top - p}px, ${rect.left - p}px ${rect.bottom + p}px, ${rect.right + p}px ${rect.bottom + p}px, ${rect.right + p}px ${rect.top - p}px, 0 ${rect.top - p}px)`;
              }
          }
          
          tutorialOverlay.style.clipPath = clipPathValue;
          
          if (tutorialTooltip.classList.contains('mobile-layout')) {
              tutorialTooltip.style.top = ''; 
              tutorialTooltip.style.left = '';
          } else {
              tutorialTooltip.style.visibility = 'hidden';
              tutorialTooltip.classList.add('show');
              const ttRect = tutorialTooltip.getBoundingClientRect();
              tutorialTooltip.classList.remove('show');
              tutorialTooltip.style.visibility = '';

              let tooltipTop, tooltipLeft;
              
              if (step.isMap) {
                  tooltipTop = window.innerHeight - ttRect.height - 20;
                  tooltipLeft = (window.innerWidth / 2) - (ttRect.width / 2);
              } else {
                  const positions = [step.preferredPosition, 'bottom', 'top', 'right', 'left', 'center'];
                  let bestPosition = '';
                  const margin = 15;

                  for (const pos of positions) {
                      if (pos === 'bottom' && rect.bottom + ttRect.height + margin < window.innerHeight) { bestPosition = 'bottom'; break; }
                      if (pos === 'top' && rect.top - ttRect.height - margin > 0) { bestPosition = 'top'; break; }
                      if (pos === 'right' && rect.right + ttRect.width + margin < window.innerWidth) { bestPosition = 'right'; break; }
                      if (pos === 'left' && rect.left - ttRect.width - margin > 0) { bestPosition = 'left'; break; }
                  }
                  bestPosition = bestPosition || step.preferredPosition;

                  switch (bestPosition) {
                      case 'top':
                          tooltipTop = rect.top - ttRect.height - margin;
                          tooltipLeft = rect.left + (rect.width / 2) - (ttRect.width / 2);
                          break;
                      case 'left':
                          tooltipLeft = rect.left - ttRect.width - margin;
                          tooltipTop = rect.top + (rect.height / 2) - (ttRect.height / 2);
                          break;
                      case 'right':
                          tooltipLeft = rect.right + margin;
                          tooltipTop = rect.top + (rect.height / 2) - (ttRect.height / 2);
                          break;
                      case 'bottom-center':
                          tooltipTop = window.innerHeight - ttRect.height - 20;
                          tooltipLeft = window.innerWidth / 2 - ttRect.width / 2;
                          break;
                      case 'center':
                          tooltipTop = window.innerHeight / 2 - ttRect.height / 2;
                          tooltipLeft = window.innerWidth / 2 - ttRect.width / 2;
                          break;
                      case 'bottom':
                      default:
                          tooltipTop = rect.bottom + margin;
                          tooltipLeft = rect.left + (rect.width / 2) - (ttRect.width / 2);
                          break;
                  }
              }

              const tooltipPadding = 10;
              tooltipLeft = Math.max(tooltipPadding, Math.min(tooltipLeft, window.innerWidth - ttRect.width - tooltipPadding));
              tooltipTop = Math.max(tooltipPadding, Math.min(tooltipTop, window.innerHeight - ttRect.height - tooltipPadding));
              
              tutorialTooltip.style.top = `${tooltipTop}px`;
              tutorialTooltip.style.left = `${tooltipLeft}px`;
          }
          
          tutorialTooltip.classList.add('show');
      }

      nextBtn.addEventListener('click', async () => {
          if (currentStep === tutorialSteps.length - 1) {
              endTutorial();
              window.location.href = 'https://youbike.pages.dev/';
              return;
          }
      
          currentStep++;
          await showStep(currentStep);
      });

      prevBtn.addEventListener('click', async () => {
          currentStep--;
          await showStep(currentStep);
      });

      // --- END: INTERACTIVE TUTORIAL ENGINE ---
    </script>
  </body>
</html>